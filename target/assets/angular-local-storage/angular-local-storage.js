/*
 MIT License, http://www.opensource.org/licenses/MIT
*/
(function(K,h){var F=h.isDefined,z=h.isUndefined,G=h.isNumber,u=h.isObject,H=h.isArray,I=h.extend,A=h.toJson;h.module("LocalStorageModule",[]).provider("localStorageService",function(){this.prefix="ls";this.storageType="localStorage";this.cookie={expiry:30,path:"/"};this.notify={setItem:!0,removeItem:!1};this.setPrefix=function(c){this.prefix=c;return this};this.setStorageType=function(c){this.storageType=c;return this};this.setStorageCookie=function(c,p){this.cookie.expiry=c;this.cookie.path=p;return this};
this.setStorageCookieDomain=function(c){this.cookie.domain=c;return this};this.setNotify=function(c,p){this.notify={setItem:c,removeItem:p};return this};this.$get=["$rootScope","$window","$document","$parse",function(c,p,k,h){var l=this,g=l.prefix,r=l.cookie,v=l.notify,q=l.storageType,m;k?k[0]&&(k=k[0]):k=document;"."!==g.substr(-1)&&(g=g?g+".":"");var B=function(a){return g+a},n=function(){try{var a=q in p&&null!==p[q],b=B("__"+Math.round(1E7*Math.random()));a&&(m=p[q],m.setItem(b,""),m.removeItem(b));
return a}catch(e){return q="cookie",c.$broadcast("LocalStorageModule.notification.error",e.message),!1}}(),x=function(a,b){b=z(b)?null:A(b);if(!n||"cookie"===l.storageType)return n||c.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.setItem&&c.$broadcast("LocalStorageModule.notification.setitem",{key:a,newvalue:b,storageType:"cookie"}),s(a,b);try{m&&m.setItem(g+a,b),v.setItem&&c.$broadcast("LocalStorageModule.notification.setitem",{key:a,newvalue:b,storageType:l.storageType})}catch(e){return c.$broadcast("LocalStorageModule.notification.error",
e.message),s(a,b)}return!0},D=function(a){if(!n||"cookie"===l.storageType)return n||c.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),C(a);a=m?m.getItem(g+a):null;if(!a||"null"===a)return null;try{return JSON.parse(a)}catch(b){return a}},E=function(){var a,b;for(a=0;a<arguments.length;a++)if(b=arguments[a],n&&"cookie"!==l.storageType)try{m.removeItem(g+b),v.removeItem&&c.$broadcast("LocalStorageModule.notification.removeitem",{key:b,storageType:l.storageType})}catch(e){c.$broadcast("LocalStorageModule.notification.error",
e.message),w(b)}else n||c.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),v.removeItem&&c.$broadcast("LocalStorageModule.notification.removeitem",{key:b,storageType:"cookie"}),w(b)},t;try{t=p.navigator.cookieEnabled||"cookie"in k&&(0<k.cookie.length||-1<(k.cookie="test").indexOf.call(k.cookie,"test"))}catch(J){c.$broadcast("LocalStorageModule.notification.error",J.message),t=!1}var s=function(a,b,e){if(z(b))return!1;if(H(b)||u(b))b=A(b);if(!t)return c.$broadcast("LocalStorageModule.notification.error",
"COOKIES_NOT_SUPPORTED"),!1;try{var d="",f=new Date,h="";null===b?(f.setTime(f.getTime()+-864E5),d="; expires="+f.toGMTString(),b=""):G(e)&&0!==e?(f.setTime(f.getTime()+864E5*e),d="; expires="+f.toGMTString()):0!==r.expiry&&(f.setTime(f.getTime()+864E5*r.expiry),d="; expires="+f.toGMTString());if(a){var l="; path="+r.path;r.domain&&(h="; domain="+r.domain);k.cookie=g+a+"="+encodeURIComponent(b)+d+l+h}}catch(m){return c.$broadcast("LocalStorageModule.notification.error",m.message),!1}return!0},C=function(a){if(!t)return c.$broadcast("LocalStorageModule.notification.error",
"COOKIES_NOT_SUPPORTED"),!1;for(var b=k.cookie&&k.cookie.split(";")||[],e=0;e<b.length;e++){for(var d=b[e];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(g+a+"=")){a=decodeURIComponent(d.substring(g.length+a.length+1,d.length));try{return JSON.parse(a)}catch(f){return a}}}return null},w=function(a){s(a,null)},y=function(){for(var a=null,b=g.length,e=k.cookie.split(";"),c=0;c<e.length;c++){for(a=e[c];" "===a.charAt(0);)a=a.substring(1,a.length);a=a.substring(b,a.indexOf("="));w(a)}};
return{isSupported:n,getStorageType:function(){return q},set:x,add:x,get:D,keys:function(){if(!n)return c.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),[];var a=g.length,b=[],e;for(e in m)if(e.substr(0,a)===g)try{b.push(e.substr(a))}catch(d){return c.$broadcast("LocalStorageModule.notification.error",d.Description),[]}return b},remove:E,clearAll:function(a){var b=g?new RegExp("^"+g):RegExp();a=a?new RegExp(a):RegExp();if(!n||"cookie"===l.storageType)return n||
c.$broadcast("LocalStorageModule.notification.warning","LOCAL_STORAGE_NOT_SUPPORTED"),y();var e=g.length,d;for(d in m)if(b.test(d)&&a.test(d.substr(e)))try{E(d.substr(e))}catch(f){return c.$broadcast("LocalStorageModule.notification.error",f.message),y()}return!0},bind:function(a,b,c,d){d=d||b;var f=D(d);null===f&&F(c)?f=c:u(f)&&u(c)&&(f=I(f,c));h(b).assign(a,f);return a.$watch(b,function(a){x(d,a)},u(a[b]))},deriveKey:B,length:function(){for(var a=0,b=p[q],c=0;c<b.length;c++)0===b.key(c).indexOf(g)&&
a++;return a},cookie:{isSupported:t,set:s,add:s,get:C,remove:w,clearAll:y}}}]})})(window,window.angular);