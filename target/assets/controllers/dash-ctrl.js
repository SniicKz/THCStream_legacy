streamaApp.controller("dashCtrl",["$scope","apiService","$state","$rootScope","localStorageService","modalService","$stateParams",function(a,c,f,d,k,g,e){d.currentUser.isAdmin&&c.settings.list().success(function(b){_.find(b,{settingsKey:"TheMovieDB API key"}).value||alertify.alert("You need to fill out some required base-settings. You will be redirected to the settings page now.",function(){f.go("settings.settings")})});a.fetchFirstEpisodeAndPlay=function(b){c.dash.firstEpisodeForShow(b.id).success(function(b){f.go("player",
{videoId:b.id})})};a.showDetails=function(b){g.mediaDetailModal(b.tvShowId||b.id,b.mediaType)};e.mediaModal&&g.mediaDetailModal(e.mediaModal,e.mediaType);c.tag.list().success(function(b){a.tags=b});c.dash.listNewReleases().success(function(b){a.newReleases=b});var h=function(b,a){var c=[];_.forEach(a,function(a,d){if(_.isArray(a)&&a.length){var e=_.intersectionBy(b[d],a,"id").length?!0:!1;c.push(e)}_.isString(a)&&1<=a.length&&(e=_.includes(b[d].toLowerCase(),a.toLowerCase())?!0:!1,c.push(e))});return 0>
c.indexOf(!1)};a.dashFilter={movie:{},tvShow:{},movieFilter:function(b){return h(b,a.dashFilter.movie)},showFilter:function(b){return h(b,a.dashFilter.tvShow)}};a.markCompleted=function(b){alertify.set({buttonReverse:!0,labels:{ok:"Yes",cancel:"Cancel"}});alertify.confirm("Are you sure you want to mark this video as completed?",function(d){d&&c.viewingStatus.delete(b.id).success(function(c){_.remove(a.continueWatching,{id:b.id})})})};c.dash.listContinueWatching().success(function(b){a.continueWatching=
b});a.loadingTvShows=!0;c.dash.listShows().success(function(b){a.tvShows=b;a.loadingTvShows=!1});a.loadingMovies=!0;c.dash.listMovies().success(function(b){a.movies=b;a.loadingMovies=!1});a.loadingGenericVideos=!0;c.dash.listGenericVideos().success(function(b){a.genericVideos=b;a.loadingGenericVideos=!1});c.dash.listGenres().success(function(b){d.genres=b;e.genreId&&(d.selectedGenre=_.find(b,{id:parseInt(e.genreId)}),a.dashFilter.movie.genre=[d.selectedGenre],a.dashFilter.tvShow.genre=[d.selectedGenre])});
a.$on("changedGenre",function(b,c){d.selectedGenre=c;d.selectedGenre?(a.dashFilter.movie.genre=[d.selectedGenre],a.dashFilter.tvShow.genre=[d.selectedGenre]):(a.dashFilter.movie.genre=[],a.dashFilter.tvShow.genre=[])})}]);